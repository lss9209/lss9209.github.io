---
title: "ElasticSearch의 색인과 분석 성능 최적화(향상) 시키기"
date: 2021-03-13 10:01:47 -0400
categories: ElasticSearch
---
# 엘라스틱서치에서 색인 성능 향상

## 1 정적 매핑 활용하기
동적 매핑은 물론 ES의 유연성을 증가시켜주는 장점 중 하나이지만 데이터가 문자열인 필드를 동적으로 생성할때 자동으로 ES는 이 문자열 필드의 타입을 'text'와 'keyword'로 이중으로 매핑한다. 이때 이중 매핑이 성능을 저하시키는 역할을 할 수 있으므로 정적으로 스키마를 주어서 특정 필드는 오로지 'text'에만 매핑된다던지 하게 하면 성능을 향상시킬 수 있다. <br>

## 2 _all 필드 비활성화
ES 5.x버전 이하에만 해당되고 ES 6.x 이상의 유저는 신경쓸 부분이 아니다.(ES 6버전부터 _all 필드 사라짐) 5버전 이하의 사용자는 따로 검색해보길 바란다.

## 3 refresh_interval 변경 활용하기
refresh를 통해 메모리 버퍼캐시에 있던 문서들이 실제 디스크의 세그먼트에 저장된다. 원래 이 과정은 일정 텀을 미리 설정해두고 그 텀마다 주기적으로 진행된다.<br>
refresh가 되지 않은 문서는 검색이 되지 않기 때문에 색인과 동시에 검색을 요하는 문서는 이렇게 자주 refresh를 해줘야 한다. 그러나 이런 사례를 생각해보자.<br>
"색인을 폭발적으로 해야하는 상황(이를테면 데이터 마이그레이션)인데 색인하는 동안에는 검색요청이 없을 예정인 상황"<br>
이렇다면 이 때 refresh주기를 기본값이 1초로 하게되면 가뜩이나 마이그레이션으로 색인이 많은 성능을 잡아먹는데 거기다 Disk IO에 해당하여 성능 잡아먹는 도둑인 refresh까지 이루어지게 된다. 그래서 성능이 많이 떨어질 수 있다.<br>
따라서 이 경우에 마이그레이션 중에는 refresh를 아예 꺼주고 마이그레이션 완료 후에 다시 refresh를 켜주는 식으로 운용하면 성능적 이득을 많이 볼 수 있다.<br>

## 4 bulk API 활용하기
bulk API는 일일히 json형태로 명령들을 나열하여 작성할 수도 있고 그런 명령들을 따로 파일로 작성해서 뺴둔 뒤 --data-binary @파일명.json으로 파일에서 bulk 명령어를 읽어 올 수도 있다.<br>
어느쪽이든 간에 Bulk API를 사용한 쪽은 그 bulk API에 포함된 명령들을 단건단건 날리는 쪽에 비해 월등한 성능향상 (대략 1만건을 단건처리시 2분걸리는 거를 1만건을 bulk로 처리시 1초 소요)을 기대할 수 있다.<br>

